The prompts.chat SDK includes a fluent Domain-Specific Language (DSL) for building prompts programmatically. This chapter covers using the Prompt Builder for structured prompt construction.

## Installation

```bash
npm install prompts.chat
```

## Basic Usage

```typescript
import { builder } from 'prompts.chat';

const prompt = builder()
  .role("Senior TypeScript Developer")
  .context("You are helping review code for a production application")
  .task("Review the following code for bugs and improvements")
  .build();

console.log(prompt.content);
```

Output:
```
You are a Senior TypeScript Developer.

Context: You are helping review code for a production application

Task: Review the following code for bugs and improvements
```

## Builder Methods

### Identity Methods

**role() / persona()**
```typescript
builder()
  .role("Expert data scientist")
  // or
  .persona("Expert data scientist")
```

Sets the AI's identity. Both methods are aliases.

**context() / background()**
```typescript
builder()
  .context("Working on a healthcare application with strict privacy requirements")
  // or
  .background("Working on a healthcare application...")
```

Provides background information.

### Task Methods

**task() / instruction()**
```typescript
builder()
  .task("Analyze this dataset for anomalies")
  // or
  .instruction("Analyze this dataset for anomalies")
```

Defines the main task.

### Constraint Methods

**constraints()**
```typescript
builder()
  .constraints([
    "Keep responses under 200 words",
    "Use only Python standard library",
    "Focus on readability over performance"
  ])
```

Adds rules the AI should follow.

**rules()**
```typescript
builder()
  .rules([
    "Never expose internal implementation details",
    "Always validate inputs"
  ])
```

Alias for constraints.

### Output Methods

**output()**
```typescript
builder()
  .output("JSON with keys: summary, issues, recommendations")
```

Specifies expected output format.

**format()**
```typescript
builder()
  .format("markdown")
  // or
  .format("json")
  // or
  .format("yaml")
```

Sets output format type.

### Example Methods

**example()**
```typescript
builder()
  .example({
    input: "Review this function: function add(a, b) { return a + b }",
    output: "Clean, simple function. Consider adding type hints."
  })
```

Adds a single example.

**examples()**
```typescript
builder()
  .examples([
    { input: "...", output: "..." },
    { input: "...", output: "..." }
  ])
```

Adds multiple examples for few-shot learning.

### Variable Methods

**variable()**
```typescript
builder()
  .variable("code", { required: true, description: "Code to review" })
  .variable("language", { defaultValue: "TypeScript" })
```

Defines template variables.

**variables()**
```typescript
builder()
  .variables([
    { name: "topic", required: true },
    { name: "length", defaultValue: "500 words" }
  ])
```

Defines multiple variables at once.

### Section Methods

**section()**
```typescript
builder()
  .section("Important Notes", "Always consider edge cases...")
  .section("Output Requirements", "Format as bullet points...")
```

Adds custom named sections.

### Content Methods

**raw()**
```typescript
builder()
  .raw("Any raw content to append directly")
```

Adds raw content without formatting.

## Complete Examples

### Code Review Prompt

```typescript
import { builder } from 'prompts.chat';

const codeReviewPrompt = builder()
  .role("Senior Software Engineer and Code Reviewer")
  .context(`
    You are conducting a thorough code review for a pull request.
    The codebase uses TypeScript, React, and follows functional programming principles.
  `)
  .task("Review the provided code and identify issues")
  .constraints([
    "Focus on: bugs, security, performance, maintainability",
    "Be constructive and educational",
    "Prioritize issues by severity"
  ])
  .output(`
    Format your review as:
    ## Summary
    [Brief overview]
    
    ## Critical Issues ðŸ”´
    [Must fix before merge]
    
    ## Suggestions ðŸŸ¡
    [Recommended improvements]
    
    ## Positive Notes ðŸŸ¢
    [What's done well]
  `)
  .variable("code", { required: true })
  .variable("pr_description", { required: false })
  .build();

// Use the prompt
const filledPrompt = codeReviewPrompt.fill({
  code: `function fetchUser(id) {
    return fetch('/api/users/' + id)
      .then(r => r.json())
  }`,
  pr_description: "Added user fetching function"
});
```

### Writing Assistant Prompt

```typescript
const writingPrompt = builder()
  .persona("Professional editor and writing coach")
  .background(`
    Helping improve written content while maintaining the author's voice.
    Focused on clarity, engagement, and proper structure.
  `)
  .instruction("Edit and improve the provided text")
  .rules([
    "Preserve the author's original voice and intent",
    "Explain significant changes",
    "Don't rewrite entirelyâ€”enhance what's there"
  ])
  .examples([
    {
      input: "The product is good. People like it. It sells well.",
      output: "The product has earned strong customer approval, reflected in its impressive sales figures."
    }
  ])
  .output("Provide: 1) Edited text, 2) Summary of changes, 3) Further suggestions")
  .variable("text", { required: true })
  .variable("style", { defaultValue: "professional" })
  .variable("audience", { defaultValue: "general" })
  .build();
```

### Data Analysis Prompt

```typescript
const analysisPrompt = builder()
  .role("Data Analyst")
  .context("Analyzing business metrics for quarterly review")
  .task("Analyze the provided data and extract insights")
  .constraints([
    "Use statistical reasoning",
    "Distinguish correlation from causation",
    "Acknowledge data limitations"
  ])
  .format("json")
  .output(`{
    "summary": "string",
    "key_findings": ["string"],
    "trends": [{"metric": "string", "direction": "up|down|stable", "significance": "high|medium|low"}],
    "recommendations": ["string"],
    "caveats": ["string"]
  }`)
  .variable("data", { required: true })
  .variable("focus_area", { required: false })
  .build();
```

## Working with Built Prompts

### The BuiltPrompt Object

```typescript
const prompt = builder()
  .role("Assistant")
  .task("Help user")
  .variable("topic")
  .build();

// Access prompt properties
console.log(prompt.content);      // The prompt text
console.log(prompt.variables);    // Variable definitions
console.log(prompt.metadata);     // Role, context, etc.
```

### Filling Variables

```typescript
const prompt = builder()
  .task("Write about \${topic} in \${length} words")
  .variable("topic", { required: true })
  .variable("length", { defaultValue: "500" })
  .build();

// Fill variables
const filled = prompt.fill({
  topic: "machine learning"
  // length uses default "500"
});

console.log(filled);
// "Write about machine learning in 500 words"
```

### Validation

```typescript
const prompt = builder()
  .variable("required_var", { required: true })
  .variable("optional_var", { defaultValue: "default" })
  .build();

// Validate before filling
const validation = prompt.validate({
  optional_var: "value"
  // missing required_var
});

console.log(validation);
// { valid: false, missing: ["required_var"] }
```

## Advanced Patterns

### Composable Prompts

```typescript
// Base prompt components
const codeContext = builder()
  .context("Working with a TypeScript/React codebase")
  .constraints(["Follow React best practices", "Use TypeScript strictly"]);

// Extend for specific tasks
const reviewPrompt = builder()
  .from(codeContext)  // Inherit settings
  .role("Code Reviewer")
  .task("Review this code")
  .build();

const debugPrompt = builder()
  .from(codeContext)  // Same base
  .role("Debugger")
  .task("Find the bug in this code")
  .build();
```

### Conditional Building

```typescript
function createPrompt(options: { detailed: boolean; format: string }) {
  const b = builder()
    .role("Assistant")
    .task("Analyze the input");

  if (options.detailed) {
    b.constraints(["Provide comprehensive analysis", "Include examples"]);
  } else {
    b.constraints(["Be concise", "Key points only"]);
  }

  if (options.format === "json") {
    b.format("json")
     .output('{"analysis": "string", "confidence": number}');
  }

  return b.build();
}
```

### Template Libraries

```typescript
// prompts/templates.ts
export const baseTemplates = {
  analyst: () => builder()
    .role("Data Analyst")
    .constraints(["Use data-driven reasoning", "Cite sources"]),
  
  writer: () => builder()
    .role("Professional Writer")
    .constraints(["Clear and engaging", "Proper grammar"]),
  
  developer: () => builder()
    .role("Senior Developer")
    .constraints(["Production-quality code", "Include error handling"]),
};

// Usage
import { baseTemplates } from './prompts/templates';

const myPrompt = baseTemplates.developer()
  .task("Build a REST API endpoint")
  .variable("resource")
  .build();
```

## Integration with prompts.chat

### Saving Built Prompts

```typescript
import { builder, PromptsClient } from 'prompts.chat';

const client = new PromptsClient({ apiKey: 'your-api-key' });

const prompt = builder()
  .role("Assistant")
  .task("Help with \${task}")
  .variable("task", { required: true })
  .build();

// Save to prompts.chat
await client.prompts.create({
  title: "General Helper",
  content: prompt.content,
  description: "A flexible helper prompt",
  type: "TEXT"
});
```

### Loading and Extending

```typescript
// Load existing prompt
const existing = await client.prompts.get("prompt-id");

// Extend with builder
const extended = builder()
  .raw(existing.content)
  .constraints(["Additional constraint"])
  .build();
```

## Summary

The Prompt Builder DSL provides:
- **Fluent API** â€” Chain methods for readable prompt construction
- **Structure** â€” Organized approach to prompt components
- **Variables** â€” Built-in template variable support
- **Validation** â€” Check prompts before use
- **Composability** â€” Build and extend prompt libraries

Use the builder for programmatic prompt management in applications.
